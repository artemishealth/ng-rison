(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports,require("@angular/core")):typeof define==="function"&&define.amd?define(["exports","@angular/core"],factory):(global=global||self,factory((global.zef=global.zef||{},global.zef.ngRison={}),global.ng.core))})(this,function(exports,core){"use strict";var NOT_ID_CHAR=" '!:(),*@$";var NOT_ID_START="-0123456789";var ID_REGULAR_EXPRESSION="[^"+NOT_ID_START+NOT_ID_CHAR+"][^"+NOT_ID_CHAR+"]*";var NEXT_ID=new RegExp(ID_REGULAR_EXPRESSION,"g");var RisonParser=function(){function RisonParser(errorHandler){var _this=this;this.errorHandler=errorHandler;this.whitespace="";this.index=0;this.message="";this.table={"!":function(){var s=_this.risonString;var c=s.charAt(_this.index++);if(!c){return _this.error('"!" at end of input')}var x=_this.bangs[c];if(typeof x==="function"){return x.call(null,_this)}else if(typeof x==="undefined"){return _this.error('unknown literal: "!'+c+'"')}return x},"(":function(){var o={};var c;var count=0;while((c=_this.next())!==")"){if(count){if(c!==","){_this.error("missing ','")}}else if(c===","){return _this.error("extra ','")}else{--_this.index}var k=_this.readValue();if(typeof k==="undefined"){return undefined}if(_this.next()!==":"){return _this.error("missing ':'")}var v=_this.readValue();if(typeof v==="undefined"){return undefined}o[k]=v;count++}return o},"'":function(){var s=_this.risonString;var i=_this.index;var start=i;var segments=[];var c;while((c=s.charAt(i++))!=="'"){if(!c){return _this.error('unmatched "\'"')}if(c==="!"){if(start<i-1){segments.push(s.slice(start,i-1))}c=s.charAt(i++);if("!'".indexOf(c)>=0){segments.push(c)}else{return _this.error('invalid string escape: "!'+c+'"')}start=i}}if(start<i-1){segments.push(s.slice(start,i-1))}_this.index=i;return segments.length===1?segments[0]:segments.join("")},"-":function(){var s=_this.risonString;var i=_this.index;var start=i-1;var state="int";var permittedSigns="-";var transitions={"int+.":"frac","int+e":"exp","frac+e":"exp"};do{var c=s.charAt(i++);if(!c){break}if("0"<=c&&c<="9"){continue}if(permittedSigns.indexOf(c)>=0){permittedSigns="";continue}state=transitions[state+"+"+c.toLowerCase()];if(state==="exp"){permittedSigns="-"}}while(state);_this.index=--i;s=s.slice(start,i);if(s==="-"){return _this.error("invalid number")}if(_this.leadingOrTrailingZero(s)){return s}else{return Number(s)}}};this.bangs={t:true,f:false,n:null,"(":this.parseArray};this.leadingOrTrailingZero=function(value){return value.substring(0,1)==="0"||value.substring(value.length-1)==="0"};for(var i=0;i<=9;i++){this.table[String(i)]=this.table["-"]}}RisonParser.prototype.parse=function(risonString){this.risonString=risonString;var value=this.readValue();if(!this.message&&this.next()){value=this.error("unable to parse string as rison: '"+risonString+"'")}if(this.message&&this.errorHandler){this.errorHandler(this.message,this.index)}return value};RisonParser.prototype.readValue=function(){var character=this.next();var parseFn=character&&this.table[character];if(parseFn){return parseFn.apply(this)}var s=this.risonString;var i=this.index-1;NEXT_ID.lastIndex=i;var m=NEXT_ID.exec(s);if(m&&m.length>0){var id=m[0];this.index=i+id.length;return id}if(character){return this.error("invalid character: '"+character+"'")}return this.error("empty expression")};RisonParser.prototype.next=function(){var character;var ind=this.index;do{if(this.index===this.risonString.length){return undefined}character=this.risonString.charAt(ind++)}while(this.whitespace.indexOf(character)>=0);this.index=ind;return character};RisonParser.prototype.error=function(message){console.error("Rison parser error: ",message);this.message=message;return undefined};RisonParser.prototype.parseArray=function(parser){var ar=[];var c;while((c=parser.next())!==")"){if(!c){return parser.error("unmatched '!('")}if(ar.length){if(c!==","){parser.error("missing ','")}}else if(c===","){return parser.error("extra ','")}else{--parser.index}var n=parser.readValue();if(typeof n==="undefined"){return undefined}ar.push(n)}return ar};return RisonParser}();var RisonService=function(){function RisonService(){this.notIdChar=" '!:(),*@$";this.notIdStart="-0123456789";this.idRegularExpression="[^"+this.notIdStart+this.notIdChar+"][^"+this.notIdChar+"]*";this.idOk=new RegExp("^"+this.idRegularExpression+"$");this.nextId=new RegExp(this.idRegularExpression,"g");this.sq={"'":true,"!":true}}RisonService.prototype.stringify=function(obj){return""};RisonService.prototype.parse=function(url){var errorCb=function(e){throw Error("rison decoder error: "+e)};var parser=new RisonParser(errorCb);return parser.parse(url)};RisonService.decorators=[{type:core.Injectable}];return RisonService}();var NgRisonModule=function(){function NgRisonModule(){}NgRisonModule.decorators=[{type:core.NgModule,args:[{providers:[RisonService]}]}];return NgRisonModule}();exports.NgRisonModule=NgRisonModule;exports.RisonParser=RisonParser;exports.RisonService=RisonService;Object.defineProperty(exports,"__esModule",{value:true})});